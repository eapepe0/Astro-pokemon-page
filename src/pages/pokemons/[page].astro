---

// Codigo server side only - Momento de construccion build time
import { imageConfig } from 'astro:assets';
import type { PokemonListResponse} from '@interfaces/pokemon-list.response';
import MainLayout from "@layouts/MainLayout.astro";
import PokemonCard from '@components/PokemonCard.astro';
import type { GetStaticPaths } from 'astro';
import Title from '@components/shared/Title.astro';

 // getStaticPaths devuelve una funcion llamada paginate,  
 // el cual genera un array dividiendo el contendido en paginas separadas

export const getStaticPaths = (async ({paginate}) => {

const respuesta = await fetch('https://pokeapi.co/api/v2/pokemon?limit=151');  // obtenemos los 151 pokemones
const {results} = await respuesta.json() as PokemonListResponse;  // extraemos los result y los tratamos como PokemonListResponse

// paginate devuelve =
// [
//   { params: { page: '1' }, props: { page: [Object] } },
//   { params: { page: '2' }, props: { page: [Object] } },
//   { params: { page: '3' }, props: { page: [Object] } },
//   { params: { page: '4' }, props: { page: [Object] } },
//   { params: { page: '5' }, props: { page: [Object] } },
// ]

return paginate(results , {pageSize : 40})

}) satisfies GetStaticPaths;


// paginate pasa la prop page a cada pagina renderizada 

 // page = {
 /*  data: [
    { name: 'pidgey', url: 'https://pokeapi.co/api/v2/pokemon/16/' },
    { name: 'pidgeotto', url: 'https://pokeapi.co/api/v2/pokemon/17/' },
    { name: 'pidgeot', url: 'https://pokeapi.co/api/v2/pokemon/18/' },
    { name: 'rattata', url: 'https://pokeapi.co/api/v2/pokemon/19/' },
    { name: 'raticate', url: 'https://pokeapi.co/api/v2/pokemon/20/' }
  ],
  start: 15,
  end: 19,
  size: 5,
  total: 151,
  currentPage: 4,
  lastPage: 31,
  url: {
    current: '/pokemons/4',
    next: '/pokemons/5',
    prev: '/pokemons/3',
    first: '/pokemons/1',
    last: '/pokemons/31'
  }
} */

const {page} = Astro.props;


const title = `Pok√©mon Page | ${page.currentPage}`;

---
<MainLayout title={title}>
	<Title>Paginado de Pokemons</Title>
	
<section aria-label="Paginado de Pokemons" class="py-5 grid grid-cols-1 sm:grid-cols-3 md:grid-cols-4 gap-4">
	{
		page.data.map(({name , url})=>(
			<PokemonCard name={name} url={url}/>
		))
	}
</section>
	
<section class="flex px-8 my-10 gap-2 items-center w-full justify-between">
	<a class:list={["btn",{"disabled":!page.url.prev}]} href={page.url.prev}>Anteriores</a>
	<span class="text-xl">{`Pagina : ${page.currentPage}`}</span>
	<a class:list={["btn",{"disabled":!page.url.next}]} href={page.url.next}>Siguientes</a>

</section>

</MainLayout>

<style>
	.btn{
		@apply bg-blue-500 p-2 text-white rounded-md;
	}

	.disabled{
		@apply bg-gray-600 text-gray-400;
	}
</style>